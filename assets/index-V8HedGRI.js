import{r as l,u as _,a as E,j as p,b as I}from"./index-A_xBCTec.js";import{u as A,P as B,F as C}from"./use.scroll.restoration-DCMQtzCZ.js";var w=new Map,m=new WeakMap,S=0,V=void 0;function $(t){return t?(m.has(t)||(S+=1,m.set(t,S.toString())),m.get(t)):"0"}function F(t){return Object.keys(t).sort().filter(e=>t[e]!==void 0).map(e=>`${e}_${e==="root"?$(t.root):t[e]}`).toString()}function M(t){const e=F(t);let s=w.get(e);if(!s){const i=new Map;let n;const a=new IntersectionObserver(o=>{o.forEach(r=>{var c;const d=r.isIntersecting&&n.some(u=>r.intersectionRatio>=u);t.trackVisibility&&typeof r.isVisible>"u"&&(r.isVisible=d),(c=i.get(r.target))==null||c.forEach(u=>{u(d,r)})})},t);n=a.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),s={id:e,observer:a,elements:i},w.set(e,s)}return s}function N(t,e,s={},i=V){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const c=t.getBoundingClientRect();return e(i,{isIntersecting:i,target:t,intersectionRatio:typeof s.threshold=="number"?s.threshold:0,time:0,boundingClientRect:c,intersectionRect:c,rootBounds:c}),()=>{}}const{id:n,observer:a,elements:o}=M(s),r=o.get(t)||[];return o.has(t)||o.set(t,r),r.push(e),a.observe(t),function(){r.splice(r.indexOf(e),1),r.length===0&&(o.delete(t),a.unobserve(t)),o.size===0&&(a.disconnect(),w.delete(n))}}function O({threshold:t,delay:e,trackVisibility:s,rootMargin:i,root:n,triggerOnce:a,skip:o,initialInView:r,fallbackInView:c,onChange:d}={}){var u;const[g,f]=l.useState(null),P=l.useRef(),[b,L]=l.useState({inView:!!r,entry:void 0});P.current=d,l.useEffect(()=>{if(o||!g)return;let v;return v=N(g,(y,x)=>{L({inView:y,entry:x}),P.current&&P.current(y,x),x.isIntersecting&&a&&v&&(v(),v=void 0)},{root:n,rootMargin:i,threshold:t,trackVisibility:s,delay:e},c),()=>{v&&v()}},[Array.isArray(t)?t.toString():t,g,n,i,a,o,s,c,e]);const R=(u=b.entry)==null?void 0:u.target,j=l.useRef();!g&&R&&!a&&!o&&j.current!==R&&(j.current=R,L({inView:!!r,entry:void 0}));const h=[f,b.inView,b.entry];return h.ref=h[0],h.inView=h[1],h.entry=h[2],h}const T=t=>t.reduce((e,s)=>{const i=s.match(/_page=(\d+)/),n=s.match(/rel="([^"]+)"/);if(i&&n){const a=parseInt(i[1],10),o=n[1];e[o]=a}return e},{}),q="https://jsonplaceholder.typicode.com",z=async t=>{var f;const{limit:e=10,page:s,signal:i}=t,n=await fetch(`${q}/albums/1/photos/?_page=${s}_limit=${e}`,{signal:i}),a=await n.json(),o=+(n==null?void 0:n.headers.get("x-total-count")),r=(f=n==null?void 0:n.headers.get("Link"))==null?void 0:f.split(","),{last:c,first:d,next:u,prev:g}=T(r);return{photoList:a,totalCount:o,firstPage:d,prevPage:g,nextPage:u,lastPage:c}},H="_intersect_15l3q_1",U={intersect:H},W=()=>{const{photoList:t,lastPage:e,page:s}=_(),{addPhotos:i,setLastPage:n,setPage:a}=E(),[o,r]=l.useState("init"),c=l.useRef(new AbortController),d=async f=>{try{r("loading");const{photoList:P,lastPage:b}=await z({page:f,signal:c.current.signal});a(f+1),n(b),i(P),r("success")}catch{r("error")}},u=f=>{f&&s-1<e&&d(s)};l.useEffect(()=>{d(s)},[]);const[g]=O({onChange:u});return A(W.name),l.useEffect(()=>()=>{c.current.abort()},[]),p.jsxs(p.Fragment,{children:[p.jsx(B,{photoList:t,FavoriteButton:C}),o==="loading"&&p.jsx(I,{center:s===1}),o==="error"&&p.jsx("div",{children:"Произошла ошибка при загрузке фотографий, попробуйте позже..."}),o!=="loading"&&p.jsx("div",{className:U.intersect,ref:g,"aria-description":"intersection element"})]})};export{W as default};
